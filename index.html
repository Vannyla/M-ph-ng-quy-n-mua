<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√¥ Ph·ªèng Quy·ªÅn Mua & C·ªï T·ª©c</title>
    <!-- T·∫£i Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* T√πy ch·ªânh nh·ªè cho input number ƒë·ªÉ ·∫©n m≈©i t√™n */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <!-- TI√äU ƒê·ªÄ - Chuy·ªÉn sang Navy -->
        <div class="bg-blue-900 p-5">
            <h1 class="text-2xl md:text-3xl font-bold text-white text-center">
                M√¥ ph·ªèng Quy·ªÅn Mua & C·ªï T·ª©c
            </h1>
            <p class="text-center text-blue-200 text-sm mt-1">C√¥ng c·ª• h·ªó tr·ª£ nh√† ƒë·∫ßu t∆∞ ra quy·∫øt ƒë·ªãnh</p>
        </div>

        <!-- KH·ªêI NH·∫¨P LI·ªÜU -->
        <div class="p-6 md:p-8">
            <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                PH·∫¶N 1: NH·∫¨P TH√îNG TIN GIAO D·ªäCH
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- C·ªôt tr√°i -->
                <div>
                    <div class="mb-4">
                        <label for="currentShares" class="block text-sm font-medium text-gray-700 mb-1">1. S·ªë l∆∞·ª£ng c·ªï phi·∫øu (N)</label>
                        <input type="number" id="currentShares" placeholder="S·ªë CP ƒëang n·∫Øm gi·ªØ" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label for="priceBefore" class="block text-sm font-medium text-gray-700 mb-1">2. Gi√° ƒë√≥ng c·ª≠a tr∆∞·ªõc GDKHQ (P)</label>
                        <input type="number" id="priceBefore" placeholder="V√≠ d·ª•: 16650" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label for="cashDividend" class="block text-sm font-medium text-gray-700 mb-1">3. C·ªï t·ª©c b·∫±ng ti·ªÅn / CP (C)</label>
                        <input type="number" id="cashDividend" placeholder="ƒê·ªÉ 0 n·∫øu kh√¥ng c√≥" value="0" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- C·ªôt ph·∫£i -->
                <div>
                    <div class="mb-4">
                        <label for="stockDividendRatio" class="block text-sm font-medium text-gray-700 mb-1">4. T·ª∑ l·ªá c·ªï t·ª©c/th∆∞·ªüng b·∫±ng CP (%)</label>
                        <input type="number" id="stockDividendRatio" placeholder="ƒê·ªÉ 0 n·∫øu kh√¥ng c√≥" value="0" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">5. T·ª∑ l·ªá th·ª±c hi·ªán quy·ªÅn mua (ƒê·ªÉ tr·ªëng n·∫øu ch·ªâ chia c·ªï t·ª©c)</label>
                        <div class="flex items-center space-x-2">
                            <label for="rightsRatioOld" class="text-sm">C≈©:</label>
                            <input type="number" id="rightsRatioOld" placeholder="V√≠ d·ª•: 300" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <label for="rightsRatioNew" class="text-sm">M·ªõi:</label>
                            <input type="number" id="rightsRatioNew" placeholder="V√≠ d·ª•: 200" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="issuePrice" class="block text-sm font-medium text-gray-700 mb-1">6. Gi√° ph√°t h√†nh ∆∞u ƒë√£i (Pa)</label>
                        <input type="number" id="issuePrice" placeholder="ƒê·ªÉ 0 n·∫øu kh√¥ng c√≥ quy·ªÅn mua" value="0" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
            
            <!-- N√∫t T√≠nh To√°n - Chuy·ªÉn sang Navy -->
            <div class="mt-6 text-center">
                <button id="calculateBtn" class="w-full md:w-1/2 bg-blue-800 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-900 transition duration-300 ease-in-out">
                    PH√ÇN T√çCH
                </button>
            </div>
        </div>

        <!-- KH·ªêI K·∫æT QU·∫¢ (·∫®n ban ƒë·∫ßu) -->
        <div id="results" class="hidden">
            <!-- Ph·∫ßn 2: K·∫øt qu·∫£ t√≠nh to√°n (Chung cho c·∫£ 2) -->
            <div class="p-6 md:p-8 bg-gray-50">
                <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                    PH·∫¶N 2: K·∫æT QU·∫¢ T√çNH TO√ÅN
                </h2>
                <div class="bg-white p-6 rounded-lg shadow-md border border-blue-100">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Gi√° c·ªï phi·∫øu ƒëi·ªÅu ch·ªânh (P')</h3>
                    <!-- Gi√° ƒëi·ªÅu ch·ªânh - Navy -->
                    <p id="adjustedPriceResult" class="text-3xl font-bold text-blue-800 mb-4">
                        <!-- 38,000 VND -->
                    </p>
                    <div class="bg-gray-100 p-4 rounded-md">
                        <h4 class="font-semibold text-gray-700 mb-2">Di·ªÖn gi·∫£i c√¥ng th·ª©c:</h4>
                        <p class="text-sm text-gray-600 italic">
                            Gi√° ƒëi·ªÅu ch·ªânh (P') = (P + Pa * R2 - C) / (1 + R1 + R2)
                        </p>
                        <div id="explanation" class="text-sm text-gray-600 mt-2 space-y-1">
                            <!-- Di·ªÖn gi·∫£i chi ti·∫øt s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- K·ªäCH B·∫¢N 1: C√ì QUY·ªÄN MUA -->
            <div id="rightsIssueAnalysis" class="hidden">
                <!-- Ph·∫ßn 3: So s√°nh quy·∫øt ƒë·ªãnh -->
                <div class="p-6 md:p-8">
                    <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                        PH·∫¶N 3: SO S√ÅNH QUY·∫æT ƒê·ªäNH (T·∫†M T√çNH T·∫†I NG√ÄY GDKHQ)
                    </h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border border-gray-200 rounded-lg">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">Ti√™u ch√≠ so s√°nh</th>
                                    <!-- Ti√™u ƒë·ªÅ K·ªãch b·∫£n 1 - Chuy·ªÉn sang Emerald -->
                                    <th class="p-4 text-left text-sm font-semibold text-white bg-emerald-600">
                                        ‚úÖ TH·ª∞C HI·ªÜN QUY·ªÄN MUA
                                    </th>
                                    <!-- Ti√™u ƒë·ªÅ K·ªãch b·∫£n 2 - Gi·ªØ m√†u ƒê·ªè -->
                                    <th class="p-4 text-left text-sm font-semibold text-white bg-red-600">
                                        ‚ùå T·ª™ B·ªé QUY·ªÄN MUA
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">S·ªë CP n·∫Øm gi·ªØ ban ƒë·∫ßu</td>
                                    <td id="val-n1" class="p-4"></td>
                                    <td id="val-n2" class="p-4"></td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">S·ªë CP th∆∞·ªüng/c·ªï t·ª©c</td>
                                    <td id="val-bonus1" class="p-4"></td>
                                    <td id="val-bonus2" class="p-4"></td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">S·ªë CP ƒë∆∞·ª£c mua th√™m</td>
                                    <!-- Text Emerald -->
                                    <td id="val-new1" class="p-4 font-semibold text-emerald-700"></td>
                                    <td id="val-new2" class="p-4 font-semibold text-red-700">0 CP</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800">T·ªïng s·ªë CP sau GDKHQ</td>
                                    <!-- Text Emerald -->
                                    <td id="val-total-n1" class="p-4 font-bold text-lg text-emerald-700"></td>
                                    <td id="val-total-n2" class="p-4 font-bold text-lg text-red-700"></td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">Ti·ªÅn m·∫∑t nh·∫≠n (C·ªï t·ª©c)</td>
                                    <td id="val-cash-in1" class="p-4"></td>
                                    <td id="val-cash-in2" class="p-4"></td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">Ti·ªÅn m·∫∑t n·ªôp (Mua CP)</td>
                                    <td id="val-cash-out1" class="p-4 text-red-600"></td>
                                    <td id="val-cash-out2" class="p-4">0 VND</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800">Thay ƒë·ªïi ti·ªÅn m·∫∑t r√≤ng</td>
                                    <td id="val-net-cash1" class="p-4 font-bold text-lg"></td>
                                    <td id="val-net-cash2" class="p-4 font-bold text-lg"></td>
                                </tr>
                                <!-- N·ªÅn highlight - Navy -->
                                <tr class="bg-blue-50 border-t-2 border-blue-200">
                                    <td class="p-4 font-bold text-blue-800">
                                        L·ª£i √≠ch / L·ªó t·∫°m t√≠nh<br>
                                        <span class="text-xs font-normal">(Ch√™nh l·ªách P' v√† Pa)</span>
                                    </td>
                                    <!-- Text Emerald -->
                                    <td id="val-benefit" class="p-4 font-bold text-2xl text-emerald-600"></td>
                                    <td id="val-loss" class="p-4 font-bold text-2xl text-red-600"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ph·∫ßn 4: Di·ªÖn gi·∫£i & Khuy·∫øn ngh·ªã -->
                <div class="p-6 md:p-8">
                    <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                        PH·∫¶N 4: DI·ªÑN GI·∫¢I & KHUY·∫æN NGH·ªä (TR∆Ø·ªúNG H·ª¢P C√ì QUY·ªÄN MUA)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <!-- K·ªãch b·∫£n 1 - Chuy·ªÉn sang Emerald -->
                        <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded-r-lg shadow">
                            <h4 class="font-bold text-lg text-emerald-800 mb-2">‚úÖ K·ªäCH B·∫¢N 1: TH·ª∞C HI·ªÜN QUY·ªÄN</h4>
                            <div id="dynamic-reco-1" class="text-sm text-gray-700 space-y-2">
                                <!-- N·ªôi dung ƒë·ªông -->
                            </div>
                        </div>
                        <!-- K·ªãch b·∫£n 2 - Gi·ªØ m√†u ƒê·ªè -->
                        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow">
                            <h4 class="font-bold text-lg text-red-800 mb-2">‚ùå K·ªäCH B·∫¢N 2: T·ª™ B·ªé QUY·ªÄN</h4>
                            <div id="dynamic-reco-2" class="text-sm text-gray-700 space-y-2">
                                <!-- N·ªôi dung ƒë·ªông -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ph·∫ßn 5: V√≠ d·ª• minh h·ªça - N·ªÅn trung t√≠nh -->
                <div class="p-6 md:p-8 bg-gray-50">
                    <h2 class="text-xl font-bold text-gray-800 border-b-2 border-gray-200 pb-2 mb-6">
                        PH·∫¶N 5: V√ç D·ª§ MINH H·ªåA (QU√ÅN C√Ä PH√ä "PHA LO√ÉNG")
                    </h2>
                    <div class="space-y-4 text-sm text-gray-700">
                        <p>H√£y t∆∞·ªüng t∆∞·ª£ng c√¥ng ty l√† m·ªôt <strong>qu√°n c√† ph√™ tr·ªã gi√° 100 tri·ªáu VND</strong>, ƒë∆∞·ª£c chia l√†m <strong>10 "Ph·∫ßn"</strong> (t∆∞∆°ng ƒë∆∞∆°ng 10 c·ªï phi·∫øu). B·∫°n ƒëang s·ªü h·ªØu 1 "Ph·∫ßn", tr·ªã gi√° 10 tri·ªáu.</p>
                        <p>Qu√°n mu·ªën huy ƒë·ªông th√™m v·ªën (ph√°t h√†nh th√™m) b·∫±ng c√°ch t·∫°o ra <strong>10 "Ph·∫ßn" m·ªõi</strong> (t·ª∑ l·ªá 1:1) v√† b√°n cho c√°c ch·ªß s·ªü h·ªØu c≈© (c·ªï ƒë√¥ng hi·ªán h·ªØu) v·ªõi <strong>gi√° ∆∞u ƒë√£i ch·ªâ 5 tri·ªáu / Ph·∫ßn</strong>.</p>
                        <ul class="list-disc list-inside space-y-3 pl-4">
                            <li>
                                <strong>Pha lo√£ng l√† g√¨?</strong> Ngay khi quy·∫øt ƒë·ªãnh n√†y ƒë∆∞·ª£c ƒë∆∞a ra, t·ªïng s·ªë "Ph·∫ßn" c·ªßa qu√°n s·∫Ω l√† 20 (10 c≈© + 10 m·ªõi). Gi√° tr·ªã m·ªói "Ph·∫ßn" c·ªßa b·∫°n ngay l·∫≠p t·ª©c b·ªã "pha lo√£ng" (gi·∫£m) v√¨ gi√° tr·ªã 100 tri·ªáu ban ƒë·∫ßu c·ªßa qu√°n gi·ªù ph·∫£i chia cho 20 "Ph·∫ßn".
                            </li>
                            <li>
                                <strong>‚úÖ K·ªãch b·∫£n TH·ª∞C HI·ªÜN QUY·ªÄN:</strong> B·∫°n n·ªôp 5 tri·ªáu, mua th√™m 1 "Ph·∫ßn" m·ªõi. 
                                <br>-> B·∫°n c√≥ t·ªïng c·ªông 2 "Ph·∫ßn" (tr√™n t·ªïng 20) v√† v·∫´n gi·ªØ 1/10 t·ª∑ l·ªá s·ªü h·ªØu qu√°n. B·∫°n ƒë√£ d√πng 5 tri·ªáu ti·ªÅn m·∫∑t ƒë·ªÉ ƒë·ªïi l·∫•y 1 "Ph·∫ßn" (t√†i s·∫£n) c√≥ gi√° tr·ªã cao h∆°n. <strong class="text-emerald-700">B·∫°n ƒë√£ b·∫£o to√†n ƒë∆∞·ª£c t√†i s·∫£n c·ªßa m√¨nh.</strong>
                            </li>
                            <li>
                                <strong>‚ùå K·ªãch b·∫£n T·ª™ B·ªé QUY·ªÄN:</strong> B·∫°n kh√¥ng n·ªôp ti·ªÅn. Ng∆∞·ªùi kh√°c s·∫Ω mua "Ph·∫ßn" ƒë√≥.
                                <br>-> B·∫°n v·∫´n ch·ªâ c√≥ 1 "Ph·∫ßn", nh∆∞ng t·ª∑ l·ªá s·ªü h·ªØu c·ªßa b·∫°n t·∫°i qu√°n ƒë√£ <strong class="text-red-700">gi·∫£m vƒ©nh vi·ªÖn</strong> (ch·ªâ c√≤n 1/20). B·∫°n ƒë√£ m·∫•t ƒëi "c∆° h·ªôi" mua t√†i s·∫£n (Ph·∫ßn) v·ªõi gi√° r·∫ª. Kho·∫£n "thi·ªát h·∫°i" ch√≠nh l√† <strong>5 tri·ªáu</strong> (ch√™nh l·ªách gi·ªØa gi√° tr·ªã ƒë√°ng l·∫Ω b·∫°n ƒë∆∞·ª£c h∆∞·ªüng v√† gi√° mua ∆∞u ƒë√£i) m√† b·∫°n ƒë√£ "t·ª´ ch·ªëi".
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- H·∫æT K·ªäCH B·∫¢N 1 -->

            <!-- K·ªäCH B·∫¢N 2: CH·ªà C√ì C·ªî T·ª®C -->
            <div id="dividendOnlyAnalysis" class="hidden">
                <!-- Ph·∫ßn 3: So s√°nh quy·∫øt ƒë·ªãnh (S·ª≠a ƒë·ªïi) -->
                <div class="p-6 md:p-8">
                    <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                        PH·∫¶N 3: SO S√ÅNH QUY·∫æT ƒê·ªäNH (CH·ªà CHIA C·ªî T·ª®C/TH∆Ø·ªûNG)
                    </h2>
                    <p class="text-sm text-gray-600 mb-4 italic">So s√°nh d√†nh cho c·ªï ƒë√¥ng ƒêANG N·∫ÆM GI·ªÆ (N) c·ªï phi·∫øu t·∫°i gi√° (P).</p>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border border-gray-200 rounded-lg">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-700">Ti√™u ch√≠ so s√°nh</th>
                                    <!-- Ti√™u ƒë·ªÅ K·ªãch b·∫£n 1 - Chuy·ªÉn sang Emerald -->
                                    <th class="p-4 text-left text-sm font-semibold text-white bg-emerald-600">
                                        ‚úÖ N·∫ÆM GI·ªÆ H∆Ø·ªûNG QUY·ªÄN
                                    </th>
                                    <!-- Ti√™u ƒë·ªÅ K·ªãch b·∫£n 2 - Chuy·ªÉn sang X√°m trung t√≠nh -->
                                    <th class="p-4 text-left text-sm font-semibold text-white bg-gray-500">
                                        üîÑ B√ÅN (gi√° P) & MUA L·∫†I (gi√° P')
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">S·ªë CP n·∫Øm gi·ªØ ban ƒë·∫ßu</td>
                                    <td id="div-val-n1" class="p-4"></td>
                                    <td class="p-4">B√°n <span id="div-val-n-sell"></span> t·∫°i gi√° P</td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">Ti·ªÅn m·∫∑t nh·∫≠n (C·ªï t·ª©c)</td>
                                    <!-- Text Emerald -->
                                    <td id="div-val-cash-in1" class="p-4 text-emerald-600 font-semibold"></td>
                                    <td class="p-4">0 VND</td>
                                </tr>
                                <tr>
                                    <td class="p-4 font-medium text-gray-600">S·ªë CP th∆∞·ªüng/c·ªï t·ª©c</td>
                                    <!-- Text Emerald -->
                                    <td id="div-val-bonus1" class="p-4 text-emerald-600 font-semibold"></td>
                                    <td class="p-4">0 CP</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800">T·ªïng s·ªë CP s·ªü h·ªØu (Sau GDKHQ)</td>
                                    <!-- Text Emerald -->
                                    <td id="div-val-total-n1" class="p-4 font-bold text-lg text-emerald-700"></td>
                                    <!-- Text X√°m -->
                                    <td id="div-val-total-n2" class="p-4 font-bold text-lg text-gray-700"></td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800">Ti·ªÅn m·∫∑t r√≤ng (Sau GDKHQ)</td>
                                    <td id="div-val-net-cash1" class="p-4 font-bold text-lg"></td>
                                    <td id="div-val-net-cash2" class="p-4 font-bold text-lg"></td>
                                </tr>
                                <!-- N·ªÅn highlight - Navy -->
                                <tr class="bg-blue-50 border-t-2 border-blue-200">
                                    <td class="p-4 font-bold text-blue-800">
                                        T·ªïng gi√° tr·ªã t√†i s·∫£n<br>
                                        <span class="text-xs font-normal">(T·ªïng CP * Gi√° P' + Ti·ªÅn m·∫∑t r√≤ng)</span>
                                    </td>
                                    <!-- Text Emerald -->
                                    <td id="div-val-asset1" class="p-4 font-bold text-2xl text-emerald-600"></td>
                                    <!-- Text X√°m -->
                                    <td id="div-val-asset2" class="p-4 font-bold text-2xl text-gray-600"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            
                <!-- Ph·∫ßn 4: Di·ªÖn gi·∫£i & Khuy·∫øn ngh·ªã (C·ªï t·ª©c - S·ª≠a ƒë·ªïi) -->
                <div class="p-6 md:p-8">
                    <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                        PH·∫¶N 4: DI·ªÑN GI·∫¢I K·ªäCH B·∫¢N (CH·ªà CHIA C·ªî T·ª®C/TH∆Ø·ªûNG)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <!-- K·ªãch b·∫£n 1 - Chuy·ªÉn sang Emerald -->
                        <div class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded-r-lg shadow">
                            <h4 class="font-bold text-lg text-emerald-800 mb-2">‚úÖ K·ªäCH B·∫¢N 1: N·∫ÆM GI·ªÆ H∆Ø·ªûNG QUY·ªÄN</h4>
                            <div id="div-dynamic-reco-1" class="text-sm text-gray-700 space-y-2">
                                <!-- N·ªôi dung ƒë·ªông -->
                            </div>
                        </div>
                        <!-- K·ªãch b·∫£n 2 - Chuy·ªÉn sang X√°m trung t√≠nh -->
                        <div class="bg-gray-50 border-l-4 border-gray-500 p-4 rounded-r-lg shadow">
                            <h4 class="font-bold text-lg text-gray-800 mb-2">üîÑ K·ªäCH B·∫¢N 2: B√ÅN (P) & MUA L·∫†I (P')</h4>
                            <div id="div-dynamic-reco-2" class="text-sm text-gray-700 space-y-2">
                                <!-- N·ªôi dung ƒë·ªông -->
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 bg-gray-100 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-lg text-gray-800">K·∫æT LU·∫¨N</h4>
                        <p id="div-dynamic-conclusion" class="text-sm text-gray-700 mt-2">
                            <!-- N·ªôi dung ƒë·ªông -->
                        </p>
                    </div>
                </div>
            </div>
            <!-- H·∫æT K·ªäCH B·∫¢N 2 -->


            <!-- Ph·∫ßn 6: L∆∞u √Ω (Chung cho c·∫£ 2) -->
            <div class="p-6 md:p-8 border-t border-gray-200 bg-gray-50">
                <h2 class="text-lg font-bold text-gray-700 mb-3">PH·∫¶N 6: L∆ØU √ù QUAN TR·ªåNG</h2>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
                    <li>C√°c t√≠nh to√°n tr√™n ƒë√¢y ch·ªâ mang t√≠nh ch·∫•t tham kh·∫£o, d·ª±a tr√™n l√Ω thuy·∫øt v·ªÅ vi·ªác ƒëi·ªÅu ch·ªânh gi√° t·∫°i ng√†y GDKHQ.</li>
                    <li>Gi√° tr·ªã th·ªã tr∆∞·ªùng c·ªßa c·ªï phi·∫øu sau ng√†y GDKHQ s·∫Ω bi·∫øn ƒë·ªông theo cung c·∫ßu th·ª±c t·∫ø, kh√¥ng nh·∫•t thi·∫øt b·∫±ng ƒë√∫ng gi√° ƒëi·ªÅu ch·ªânh P'.</li>
                    <li>Quy·∫øt ƒë·ªãnh cu·ªëi c√πng ph·ª• thu·ªôc v√†o ƒë√°nh gi√° c·ªßa nh√† ƒë·∫ßu t∆∞ v·ªÅ ti·ªÅm nƒÉng tƒÉng tr∆∞·ªüng c·ªßa doanh nghi·ªáp, chi·∫øn l∆∞·ª£c ƒë·∫ßu t∆∞ c√° nh√¢n v√† c√°c y·∫øu...</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- SCRIPT KH√îNG ƒê·ªîI -->
    <script>
        document.getElementById('calculateBtn').addEventListener('click', function() {
            // --- 1. L·∫§Y D·ªÆ LI·ªÜU ƒê·∫¶U V√ÄO ---
            const N = parseFloat(document.getElementById('currentShares').value) || 0;
            const P = parseFloat(document.getElementById('priceBefore').value) || 0;
            const C = parseFloat(document.getElementById('cashDividend').value) || 0;
            const R1_percent = parseFloat(document.getElementById('stockDividendRatio').value) || 0;
            const Ratio_Old = parseFloat(document.getElementById('rightsRatioOld').value) || 0;
            const Ratio_New = parseFloat(document.getElementById('rightsRatioNew').value) || 0;
            const Pa = parseFloat(document.getElementById('issuePrice').value) || 0;

            // --- 2. KI·ªÇM TRA ƒê·∫¶U V√ÄO C∆† B·∫¢N ---
            if (P === 0 || N === 0) {
                // S·ª≠ d·ª•ng m·ªôt th√¥ng b√°o t√πy ch·ªânh (c√≥ th·ªÉ thay b·∫±ng modal)
                alert("Vui l√≤ng nh·∫≠p S·ªë l∆∞·ª£ng c·ªï phi·∫øu v√† Gi√° tr∆∞·ªõc GDKHQ.");
                return;
            }
            
            // --- 3. T√çNH TO√ÅN C√ÅC T·ª∂ L·ªÜ ---
            const R1 = R1_percent / 100; // T·ª∑ l·ªá c·ªï t·ª©c/th∆∞·ªüng b·∫±ng CP
            const R2 = (Ratio_Old > 0 && Ratio_New > 0) ? (Ratio_New / Ratio_Old) : 0; // T·ª∑ l·ªá quy·ªÅn mua

            // --- 4. T√çNH GI√Å ƒêI·ªÄU CH·ªàNH (P') ---
            const denominator = 1 + R1 + R2;
            let P_prime = P; // M·∫∑c ƒë·ªãnh
            
            // Ch·ªâ t√≠nh Pa khi c√≥ quy·ªÅn mua (R2 > 0). N·∫øu kh√¥ng, Pa = 0
            const effective_Pa = R2 > 0 ? Pa : 0;
            
            if (denominator > 0) {
                // ƒê·∫£m b·∫£o P_prime kh√¥ng √¢m, tr∆∞·ªùng h·ª£p C > P
                P_prime = Math.max(0, (P + effective_Pa * R2 - C) / denominator);
            }

            // --- 5. ƒê·ªäNH D·∫†NG S·ªê LI·ªÜU (Formatter) ---
            const formatVND = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
            const formatCP = (value) => new Intl.NumberFormat('vi-VN', { maximumFractionDigits: 2 }).format(value) + ' CP';

            // --- 6. HI·ªÇN TH·ªä PH·∫¶N 2 (CHUNG) ---
            document.getElementById('adjustedPriceResult').textContent = formatVND(P_prime);
            document.getElementById('explanation').innerHTML = `
                <p><strong>Trong ƒë√≥:</strong></p>
                <p><strong>P</strong> (Gi√° tr∆∞·ªõc GDKHQ): ${formatVND(P)}</p>
                <p><strong>Pa</strong> (Gi√° ph√°t h√†nh): ${formatVND(effective_Pa)}</p>
                <p><strong>C</strong> (C·ªï t·ª©c ti·ªÅn): ${formatVND(C)}</p>
                <p><strong>R1</strong> (T·ª∑ l·ªá th∆∞·ªüng CP): ${R1_percent}% hay ${R1.toFixed(2)}</p>
                <p><strong>R2</strong> (T·ª∑ l·ªá quy·ªÅn mua): ${R2 > 0 ? (Ratio_New + '/' + Ratio_Old) : '0'} hay ${R2.toFixed(4)}</p>
                <p class="font-semibold mt-2">P' = (${formatVND(P)} + ${formatVND(effective_Pa)} * ${R2.toFixed(4)} - ${formatVND(C)}) / (1 + ${R1.toFixed(2)} + ${R2.toFixed(4)})</p>
                <p class="font-semibold">P' = ${formatVND(P_prime)}</p>
            `;
            
            // --- 7. LOGIC PH√ÇN NH√ÅNH K·ªäCH B·∫¢N ---
            // K·ªãch b·∫£n Quy·ªÅn Mua ch·ªâ k√≠ch ho·∫°t khi C√ì T·ª∂ L·ªÜ v√† C√ì GI√Å PH√ÅT H√ÄNH
            const isRightsIssue = (R2 > 0 && Pa > 0);
            
            // ·∫®n c·∫£ 2 kh·ªëi ph√¢n t√≠ch tr∆∞·ªõc
            document.getElementById('rightsIssueAnalysis').style.display = 'none';
            document.getElementById('dividendOnlyAnalysis').style.display = 'none';

            if (isRightsIssue) {
                // --- K·ªäCH B·∫¢N 1: C√ì QUY·ªÄN MUA ---
                
                // T√≠nh to√°n
                const N_bonus = N * R1;
                const N_new = N * R2;
                const N_total_1 = N + N_bonus + N_new;
                const N_total_2 = N + N_bonus;
                const Cash_in = N * C;
                const Cash_out = N_new * Pa;
                const Net_cash_1 = Cash_in - Cash_out;
                const Net_cash_2 = Cash_in;
                // L·ª£i √≠ch = S·ªë CP mua th√™m * (Gi√° ƒëi·ªÅu ch·ªânh - Gi√° ∆∞u ƒë√£i)
                const Total_Benefit = N_new * (P_prime - Pa);

                // ƒêi·ªÅn b·∫£ng (Ph·∫ßn 3)
                document.getElementById('val-n1').textContent = formatCP(N);
                document.getElementById('val-n2').textContent = formatCP(N);
                document.getElementById('val-bonus1').textContent = formatCP(N_bonus);
                document.getElementById('val-bonus2').textContent = formatCP(N_bonus);
                document.getElementById('val-new1').textContent = formatCP(N_new);
                document.getElementById('val-total-n1').textContent = formatCP(N_total_1);
                document.getElementById('val-total-n2').textContent = formatCP(N_total_2);
                document.getElementById('val-cash-in1').textContent = formatVND(Cash_in);
                document.getElementById('val-cash-in2').textContent = formatVND(Cash_in);
                document.getElementById('val-cash-out1').textContent = `-${formatVND(Cash_out)}`;
                document.getElementById('val-net-cash1').textContent = formatVND(Net_cash_1);
                document.getElementById('val-net-cash2').textContent = formatVND(Net_cash_2);
                document.getElementById('val-benefit').textContent = formatVND(Total_Benefit);
                document.getElementById('val-loss').textContent = `-${formatVND(Total_Benefit)}`;
                
                // ƒêi·ªÅn di·ªÖn gi·∫£i (Ph·∫ßn 4)
                // Ch·ªânh s·ª≠a highlight text cho ph√π h·ª£p v·ªõi m√†u emerald
                const benefitFormatted = `<strong class='text-emerald-700'>${formatVND(Total_Benefit)}</strong>`;
                const paFormatted = `<strong>${formatVND(Pa)}</strong>`;
                const pPrimeFormatted = `<strong>${formatVND(P_prime)}</strong>`;
                const nNewFormatted = `<strong>${formatCP(N_new)}</strong>`;

                document.getElementById('dynamic-reco-1').innerHTML = 
                    `<div>Vi·ªác ph·∫£i n·ªôp th√™m ti·ªÅn ƒë·ªÉ mua ${nNewFormatted} c√≥ th·ªÉ khi·∫øn b·∫°n bƒÉn khoƒÉn.</div>
                    <div>Tuy nhi√™n, ƒë√¢y l√† m·ªôt <strong>c∆° h·ªôi</strong>: b·∫°n ƒëang d√πng ti·ªÅn m·∫∑t ƒë·ªÉ ƒë·ªïi l·∫•y t√†i s·∫£n (c·ªï phi·∫øu) v·ªõi gi√° ${paFormatted}, th·∫•p h∆°n nhi·ªÅu so v·ªõi gi√° tr·ªã h·ª£p l√Ω c·ªßa n√≥ (l√† ${pPrimeFormatted}).</div>
                    <div>Kho·∫£n l·ª£i √≠ch t·ª©c th·ªùi ${benefitFormatted} ch√≠nh l√† 'ph·∫ßn th∆∞·ªüng' cho h√†nh ƒë·ªông n√†y. ƒê√¢y l√† h√†nh ƒë·ªông <strong class='text-emerald-700'>b·∫£o to√†n gi√° tr·ªã t√†i s·∫£n</strong>.</div>`;

                document.getElementById('dynamic-reco-2').innerHTML = 
                    `<div>N·∫øu b·∫°n t·ª´ b·ªè quy·ªÅn (kh√¥ng n·ªôp ti·ªÅn), t√†i s·∫£n c·ªßa b·∫°n v·∫´n b·ªã pha lo√£ng (v√¨ gi√° P' ƒë√£ gi·∫£m), nh∆∞ng b·∫°n l·∫°i <strong class='text-red-700'>ƒë√°nh m·∫•t</strong> kho·∫£n l·ª£i √≠ch ${benefitFormatted} ·ªü tr√™n.</div>
                    <div>ƒêi·ªÅu n√†y d·∫´n ƒë·∫øn m·ªôt kho·∫£n <strong class='text-red-700'>thi·ªát h·∫°i th·ª±c s·ª±</strong> do gi√° tr·ªã t√†i s·∫£n r√≤ng c·ªßa b·∫°n b·ªã gi·∫£m s√∫t.</div>`;

                // Hi·ªÉn th·ªã kh·ªëi ph√¢n t√≠ch Quy·ªÅn Mua
                document.getElementById('rightsIssueAnalysis').style.display = 'block';

            } else {
                // --- K·ªäCH B·∫¢N 2: CH·ªà CHIA C·ªî T·ª®C/TH∆Ø·ªûNG ---
                
                // T√≠nh to√°n KB 1 (N·∫Øm gi·ªØ)
                const N_bonus = N * R1;
                const Cash_in = N * C;
                const TotalShares_1 = N + N_bonus;
                const NetCash_1 = Cash_in;
                const TotalAssetValue_1 = (TotalShares_1 * P_prime) + NetCash_1;

                // T√≠nh to√°n KB 2 (B√°n P, Mua l·∫°i P')
                const CashFromSelling = N * P;
                // S·ªë CP mua l·∫°i ƒë∆∞·ª£c, ch·ªâ mua khi P_prime > 0
                const TotalShares_2 = (P_prime > 0) ? (CashFromSelling / P_prime) : 0; 
                const NetCash_2 = 0; // V√¨ ƒë√£ d√πng h·∫øt ti·ªÅn ƒë·ªÉ mua l·∫°i CP
                const TotalAssetValue_2 = TotalShares_2 * P_prime; 
                // TotalAssetValue_2 v·ªÅ l√Ω thuy·∫øt s·∫Ω b·∫±ng CashFromSelling (N*P)

                // ƒêi·ªÅn b·∫£ng (Ph·∫ßn 3 - S·ª≠a ƒë·ªïi)
                document.getElementById('div-val-n1').textContent = formatCP(N);
                document.getElementById('div-val-n-sell').textContent = formatCP(N); // Hi·ªÉn th·ªã s·ªë CP b√°n
                document.getElementById('div-val-cash-in1').textContent = `+${formatVND(Cash_in)}`;
                document.getElementById('div-val-bonus1').textContent = `+${formatCP(N_bonus)}`;
                document.getElementById('div-val-total-n1').textContent = formatCP(TotalShares_1);
                document.getElementById('div-val-total-n2').textContent = formatCP(TotalShares_2);
                document.getElementById('div-val-net-cash1').textContent = formatVND(NetCash_1);
                document.getElementById('div-val-net-cash2').textContent = formatVND(NetCash_2);
                document.getElementById('div-val-asset1').textContent = formatVND(TotalAssetValue_1);
                document.getElementById('div-val-asset2').textContent = formatVND(TotalAssetValue_2);

                // ƒêi·ªÅn di·ªÖn gi·∫£i (Ph·∫ßn 4 - S·ª≠a ƒë·ªïi)
                document.getElementById('div-dynamic-reco-1').innerHTML = 
                    `<div>B·∫°n n·∫Øm gi·ªØ ${formatCP(N)} qua ng√†y GDKHQ.</div>
                    <div>Sau ƒë√≥, b·∫°n nh·∫≠n v·ªÅ ${formatVND(Cash_in)} ti·ªÅn m·∫∑t v√† ${formatCP(N_bonus)}.</div>
                    <div>T·ªïng t√†i s·∫£n c·ªßa b·∫°n (CP quy ƒë·ªïi theo gi√° P' + Ti·ªÅn m·∫∑t) l√† <strong class="text-emerald-700">${formatVND(TotalAssetValue_1)}</strong>.</div>`;
                
                document.getElementById('div-dynamic-reco-2').innerHTML =
                    `<div>B·∫°n b√°n ${formatCP(N)} t·∫°i gi√° P, thu v·ªÅ <strong class="text-gray-800">${formatVND(CashFromSelling)}</strong>.</div>
                    <div>Sau GDKHQ, b·∫°n d√πng to√†n b·ªô s·ªë ti·ªÅn n√†y mua l·∫°i c·ªï phi·∫øu ·ªü gi√° P', b·∫°n s·∫Ω mua ƒë∆∞·ª£c ${formatCP(TotalShares_2)}.</div>
                    <div>T·ªïng t√†i s·∫£n c·ªßa b·∫°n (ch·ªâ c√≥ CP) l√† <strong class="text-gray-700">${formatVND(TotalAssetValue_2)}</strong>.</div>`;

                // So s√°nh 2 gi√° tr·ªã t√†i s·∫£n (ƒë√£ l√†m tr√≤n) ƒë·ªÉ ƒë∆∞a ra k·∫øt lu·∫≠n
                let conclusionText = "";
                if (Math.round(TotalAssetValue_1) === Math.round(TotalAssetValue_2)) {
                    conclusionText = `V·ªÅ l√Ω thuy·∫øt, t·ªïng gi√° tr·ªã t√†i s·∫£n c·ªßa hai k·ªãch b·∫£n l√† <strong>t∆∞∆°ng ƒë∆∞∆°ng tuy·ªát ƒë·ªëi</strong>. 
                                      Quy·∫øt ƒë·ªãnh kh√¥ng l√†m thay ƒë·ªïi t√†i s·∫£n c·ªßa b·∫°n, m√† ch·ªâ thay ƒë·ªïi h√¨nh th·ª©c (t·ª´ CP sang Ti·ªÅn v√† ng∆∞·ª£c l·∫°i).`;
                } else {
                    conclusionText = `C√≥ s·ª± ch√™nh l·ªách nh·ªè do l√†m tr√≤n s·ªë. V·ªÅ b·∫£n ch·∫•t, gi√° tr·ªã t√†i s·∫£n kh√¥ng ƒë·ªïi.`;
                }
                
                conclusionText += ` Quy·∫øt ƒë·ªãnh n·∫Øm gi·ªØ hay "l∆∞·ªõt" (b√°n P mua P') ph·ª• thu·ªôc v√†o chi·∫øn l∆∞·ª£c c√° nh√¢n v√† c√°c y·∫øu t·ªë thu·∫ø/ph√≠.`;
                
                document.getElementById('div-dynamic-conclusion').innerHTML = conclusionText;

                // Hi·ªÉn th·ªã kh·ªëi ph√¢n t√≠ch C·ªï t·ª©c
                document.getElementById('dividendOnlyAnalysis').style.display = 'block';
            }

            // --- 8. HI·ªÇN TH·ªä KH·ªêI K·∫æT QU·∫¢ CHUNG ---
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        });
    </script>

</body>
</html>

