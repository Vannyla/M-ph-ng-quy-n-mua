<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô Phỏng Quyền Mua Cổ Phiếu</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Tùy chỉnh nhỏ cho input number để ẩn mũi tên */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <!-- TIÊU ĐỀ -->
        <div class="bg-blue-800 p-5">
            <h1 class="text-2xl md:text-3xl font-bold text-white text-center">
                Mô phỏng quyền mua
            </h1>
            <p class="text-center text-blue-100 text-sm mt-1">Công cụ hỗ trợ nhà đầu tư ra quyết định thực hiện quyền</p>
        </div>

        <!-- KHỐI NHẬP LIỆU -->
        <div class="p-6 md:p-8">
            <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                PHẦN 1: NHẬP THÔNG TIN GIAO DỊCH
            </h2>
            
            <!-- SỬA LỖI LAYOUT: Khôi phục cấu trúc grid 2 cột -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Cột trái -->
                <div>
                    <div class="mb-4">
                        <label for="currentShares" class="block text-sm font-medium text-gray-700 mb-1">1. Số lượng cổ phiếu đang nắm giữ (N)</label>
                        <input type="number" id="currentShares" placeholder="Ví dụ: 8700" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label for="priceBefore" class="block text-sm font-medium text-gray-700 mb-1">2. Giá đóng cửa trước GDKHQ (P)</label>
                        <input type="number" id="priceBefore" placeholder="Ví dụ: 16650" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label for="cashDividend" class="block text-sm font-medium text-gray-700 mb-1">3. Cổ tức bằng tiền / CP (C)</label>
                        <input type="number" id="cashDividend" value="500" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- Cột phải -->
                <div>
                    <div class="mb-4">
                        <label for="stockDividendRatio" class="block text-sm font-medium text-gray-700 mb-1">4. Tỷ lệ cổ tức/thưởng bằng CP (%)</label>
                        <input type="number" id="stockDividendRatio" value="0" placeholder="Ví dụ: 10 (cho 10%)" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">5. Tỷ lệ thực hiện quyền mua</label>
                        <div class="flex items-center space-x-2">
                            <label for="rightsRatioOld" class="text-sm">Cũ:</label>
                            <input type="number" id="rightsRatioOld" value="300" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <label for="rightsRatioNew" class="text-sm">Mới:</label>
                            <input type="number" id="rightsRatioNew" value="200" placeholder="CP được mua" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="issuePrice" class="block text-sm font-medium text-gray-700 mb-1">6. Giá phát hành ưu đãi (Pa)</label>
                        <input type="number" id="issuePrice" value="10000" placeholder="Ví dụ: 10000" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
            <!-- Hết phần sửa lỗi layout -->

            <!-- Nút Tính Toán -->
            <div class="mt-6 text-center">
                <button id="calculateBtn" class="w-full md:w-1/2 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition duration-300 ease-in-out">
                    PHÂN TÍCH
                </button>
            </div>
        </div>

        <!-- KHỐI KẾT QUẢ (Ẩn ban đầu) -->
        <div id="results" class="hidden">
            <!-- Phần 2: Kết quả tính toán -->
            <div class="p-6 md:p-8 bg-gray-50">
                <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                    PHẦN 2: KẾT QUẢ TÍNH TOÁN
                </h2>
                <div class="bg-white p-6 rounded-lg shadow-md border border-blue-100">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Giá cổ phiếu điều chỉnh (P')</h3>
                    <p id="adjustedPriceResult" class="text-3xl font-bold text-blue-600 mb-4">
                        <!-- 38,000 VND -->
                    </p>
                    <div class="bg-gray-100 p-4 rounded-md">
                        <h4 class="font-semibold text-gray-700 mb-2">Diễn giải công thức:</h4>
                        <p class="text-sm text-gray-600 italic">
                            Giá điều chỉnh (P') = (P + Pa * R2 - C) / (1 + R1 + R2)
                        </p>
                        <div id="explanation" class="text-sm text-gray-600 mt-2 space-y-1">
                            <!-- Diễn giải chi tiết sẽ được chèn vào đây -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phần 3: So sánh quyết định -->
            <div class="p-6 md:p-8">
                <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                    PHẦN 3: SO SÁNH QUYẾT ĐỊNH (TẠM TÍNH TẠI NGÀY GDKHQ)
                </h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-200 rounded-lg">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-4 text-left text-sm font-semibold text-gray-700">Tiêu chí so sánh</th>
                                <th class="p-4 text-left text-sm font-semibold text-white bg-green-600">
                                    ✅ THỰC HIỆN QUYỀN MUA
                                </th>
                                <th class="p-4 text-left text-sm font-semibold text-white bg-red-600">
                                    ❌ TỪ BỎ QUYỀN MUA
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="p-4 font-medium text-gray-600">Số CP nắm giữ ban đầu</td>
                                <td id="val-n1" class="p-4"></td>
                                <td id="val-n2" class="p-4"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium text-gray-600">Số CP thưởng/cổ tức</td>
                                <td id="val-bonus1" class="p-4"></td>
                                <td id="val-bonus2" class="p-4"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium text-gray-600">Số CP được mua thêm</td>
                                <td id="val-new1" class="p-4 font-semibold text-green-700"></td>
                                <td id="val-new2" class="p-4 font-semibold text-red-700">0 CP</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-4 font-bold text-gray-800">Tổng số CP sau GDKHQ</td>
                                <td id="val-total-n1" class="p-4 font-bold text-lg text-green-700"></td>
                                <td id="val-total-n2" class="p-4 font-bold text-lg text-red-700"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium text-gray-600">Tiền mặt nhận (Cổ tức)</td>
                                <td id="val-cash-in1" class="p-4"></td>
                                <td id="val-cash-in2" class="p-4"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium text-gray-600">Tiền mặt nộp (Mua CP)</td>
                                <td id="val-cash-out1" class="p-4 text-red-600"></td>
                                <td id="val-cash-out2" class="p-4">0 VND</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-4 font-bold text-gray-800">Thay đổi tiền mặt ròng</td>
                                <td id="val-net-cash1" class="p-4 font-bold text-lg"></td>
                                <td id="val-net-cash2" class="p-4 font-bold text-lg"></td>
                            </tr>
                            <tr class="bg-blue-50 border-t-2 border-blue-200">
                                <td class="p-4 font-bold text-blue-800">
                                    Lợi ích / Lỗ tạm tính<br>
                                    <span class="text-xs font-normal">(Chênh lệch P' và Pa)</span>
                                </td>
                                <td id="val-benefit" class="p-4 font-bold text-2xl text-green-600"></td>
                                <td id="val-loss" class="p-4 font-bold text-2xl text-red-600"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- THÊM MỚI: Phần 4: Diễn giải & Khuyến nghị -->
            <div class="p-6 md:p-8">
                <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                    PHẦN 4: DIỄN GIẢI & KHUYẾN NGHỊ
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <!-- Kịch bản 1: Thực hiện -->
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg shadow">
                        <h4 class="font-bold text-lg text-green-800 mb-2">✅ KỊCH BẢN 1: THỰC HIỆN QUYỀN</h4>
                        <p id="dynamic-reco-1" class="text-sm text-gray-700">
                            <!-- Nội dung động sẽ được chèn vào đây -->
                        </p>
                    </div>
                    <!-- Kịch bản 2: Từ bỏ -->
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow">
                        <h4 class="font-bold text-lg text-red-800 mb-2">❌ KỊCH BẢN 2: TỪ BỎ QUYỀN</h4>
                        <p id="dynamic-reco-2" class="text-sm text-gray-700">
                            <!-- Nội dung động sẽ được chèn vào đây -->
                        </p>
                    </div>
                </div>
            </div>
            <!-- HẾT PHẦN 4 -->

            <!-- THÊM MỚI: Phần 5: Ví dụ minh họa -->
            <div class="p-6 md:p-8 bg-blue-50">
                <h2 class="text-xl font-bold text-blue-900 border-b-2 border-blue-200 pb-2 mb-6">
                    PHẦN 5: VÍ DỤ MINH HỌA (QUÁN CÀ PHÊ "PHA LOÃNG")
                </h2>
                <div class="space-y-4 text-sm text-gray-700">
                    <p>Hãy tưởng tượng công ty là một <strong>quán cà phê trị giá 100 triệu VND</strong>, được chia làm <strong>10 "Phần"</strong> (tương đương 10 cổ phiếu). Bạn đang sở hữu 1 "Phần", trị giá 10 triệu.</p>
                    <p>Quán muốn huy động thêm vốn (phát hành thêm) bằng cách tạo ra <strong>10 "Phần" mới</strong> (tỷ lệ 1:1) và bán cho các chủ sở hữu cũ (cổ đông hiện hữu) với <strong>giá ưu đãi chỉ 5 triệu / Phần</strong>.</p>
                    
                    <ul class="list-disc list-inside space-y-3 pl-4">
                        <li>
                            <strong>Pha loãng là gì?</strong> Ngay khi quyết định này được đưa ra, tổng số "Phần" của quán sẽ là 20 (10 cũ + 10 mới). Giá trị mỗi "Phần" của bạn ngay lập tức bị "pha loãng" (giảm) vì giá trị 100 triệu ban đầu của quán giờ phải chia cho 20 "Phần".
                        </li>
                        <li>
                            <strong>✅ Kịch bản THỰC HIỆN QUYỀN:</strong> Bạn nộp 5 triệu, mua thêm 1 "Phần" mới. 
                            <br>-> Bạn có tổng cộng 2 "Phần" (trên tổng 20) và vẫn giữ 1/10 tỷ lệ sở hữu quán. Bạn đã dùng 5 triệu tiền mặt để đổi lấy 1 "Phần" (tài sản) có giá trị cao hơn. <strong class="text-green-700">Bạn đã bảo toàn được tài sản của mình.</strong>
                        </li>
                        <li>
                            <strong>❌ Kịch bản TỪ BỎ QUYỀN:</strong> Bạn không nộp tiền. Người khác sẽ mua "Phần" đó.
                            <br>-> Bạn vẫn chỉ có 1 "Phần", nhưng tỷ lệ sở hữu của bạn tại quán đã <strong class="text-red-700">giảm vĩnh viễn</strong> (chỉ còn 1/20). Bạn đã mất đi "cơ hội" mua tài sản (Phần) với giá rẻ. Khoản "thiệt hại" chính là <strong>5 triệu</strong> (chênh lệch giữa giá trị đáng lẽ bạn được hưởng và giá mua ưu đãi) mà bạn đã "từ chối".
                        </li>
                    </ul>
                </div>
            </div>
            <!-- HẾT PHẦN 5 MỚI -->


            <!-- Phần 6: Lưu ý (trước là phần 5) -->
            <div class="p-6 md:p-8 border-t border-gray-200 bg-gray-50">
                <h2 class="text-lg font-bold text-gray-700 mb-3">PHẦN 6: LƯU Ý QUAN TRỌNG</h2>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
                    <li>Các tính toán trên đây chỉ mang tính chất tham khảo, dựa trên lý thuyết về việc điều chỉnh giá tại ngày GDKHQ.</li>
                    <li>"Lỗ tạm tính" khi từ bỏ quyền chính là phần <strong class="text-gray-800">lợi ích (chiết khấu)</strong> mà nhà đầu tư đáng lẽ được hưởng nhưng đã bỏ qua.</li>
                    <li>Giá trị thị trường của cổ phiếu sau ngày GDKHQ sẽ biến động theo cung cầu thực tế, không nhất thiết bằng đúng giá điều chỉnh P'.</li>
                    <li>Quyết định cuối cùng phụ thuộc vào đánh giá của nhà đầu tư về tiềm năng tăng trưởng của doanh nghiệp và chiến lược đầu tư cá nhân.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- SỬA LỖI NÚT: Thêm lại toàn bộ script đã mất -->
    <script>
        document.getElementById('calculateBtn').addEventListener('click', function() {
            // --- 1. LẤY DỮ LIỆU ĐẦU VÀO ---
            const N = parseFloat(document.getElementById('currentShares').value) || 0;
            const P = parseFloat(document.getElementById('priceBefore').value) || 0;
            const C = parseFloat(document.getElementById('cashDividend').value) || 0;
            const R1_percent = parseFloat(document.getElementById('stockDividendRatio').value) || 0;
            const Ratio_Old = parseFloat(document.getElementById('rightsRatioOld').value) || 0;
            const Ratio_New = parseFloat(document.getElementById('rightsRatioNew').value) || 0;
            const Pa = parseFloat(document.getElementById('issuePrice').value) || 0;

            // --- 2. KIỂM TRA ĐẦU VÀO CƠ BẢN ---
            if (P === 0 || N === 0) {
                // Sử dụng một thông báo tùy chỉnh thay vì alert()
                alert("Vui lòng nhập Số lượng cổ phiếu và Giá trước GDKHQ.");
                return;
            }
            
            // --- 3. TÍNH TOÁN CÁC TỶ LỆ ---
            // R1: Tỷ lệ cổ tức/thưởng bằng CP
            const R1 = R1_percent / 100;
            // R2: Tỷ lệ quyền mua
            const R2 = (Ratio_Old > 0) ? (Ratio_New / Ratio_Old) : 0;

            // --- 4. TÍNH GIÁ ĐIỀU CHỈNH (P') ---
            const denominator = 1 + R1 + R2;
            let P_prime = P; // Mặc định
            if (denominator > 0) {
                P_prime = (P + Pa * R2 - C) / denominator;
            }

            // --- 5. TÍNH TOÁN CÁC THÔNG SỐ CHO BẢNG SO SÁNH ---
            
            // Số lượng
            const N_bonus = N * R1;  // CP thưởng
            const N_new = N * R2;    // CP quyền mua
            const N_total_1 = N + N_bonus + N_new; // Tổng CP (Thực hiện)
            const N_total_2 = N + N_bonus;       // Tổng CP (Từ bỏ)

            // Tiền mặt
            const Cash_in = N * C;                  // Cổ tức tiền nhận
            const Cash_out = N_new * Pa;            // Tiền nộp mua
            const Net_cash_1 = Cash_in - Cash_out;  // Thay đổi tiền (Thực hiện)
            const Net_cash_2 = Cash_in;             // Thay đổi tiền (Từ bỏ)

            // Lợi ích / Lỗ tạm tính (PHẦN QUAN TRỌNG NHẤT)
            const Total_Benefit = N_new * (P_prime - Pa);

            // --- 6. ĐỊNH DẠNG SỐ LIỆU (Formatter) ---
            const formatVND = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
            const formatCP = (value) => new Intl.NumberFormat('vi-VN', { maximumFractionDigits: 2 }).format(value) + ' CP';

            // --- 7. HIỂN THỊ KẾT QUẢ ---

            // Phần 2: Giá điều chỉnh
            document.getElementById('adjustedPriceResult').textContent = formatVND(P_prime);
            document.getElementById('explanation').innerHTML = `
                <p><strong>Trong đó:</strong></p>
                <p><strong>P</strong> (Giá trước GDKHQ): ${formatVND(P)}</p>
                <p><strong>Pa</strong> (Giá phát hành ưu đãi): ${formatVND(Pa)}</p>
                <p><strong>C</strong> (Cổ tức tiền): ${formatVND(C)}</p>
                <p><strong>R1</strong> (Tỷ lệ thưởng CP): ${R1_percent}% hay ${R1.toFixed(2)}</p>
                <p><strong>R2</strong> (Tỷ lệ quyền mua): ${Ratio_New}/${Ratio_Old} hay ${R2.toFixed(4)}</p>
                <p class="font-semibold mt-2">P' = (${formatVND(P)} + ${formatVND(Pa)} * ${R2.toFixed(4)} - ${formatVND(C)}) / (1 + ${R1.toFixed(2)} + ${R2.toFixed(4)})</p>
                <p class="font-semibold">P' = ${formatVND(P_prime)}</p>
            `;

            // Phần 3: Bảng so sánh
            // Cột chung
            document.getElementById('val-n1').textContent = formatCP(N);
            document.getElementById('val-n2').textContent = formatCP(N);
            document.getElementById('val-bonus1').textContent = formatCP(N_bonus);
            document.getElementById('val-bonus2').textContent = formatCP(N_bonus);
            document.getElementById('val-cash-in1').textContent = formatVND(Cash_in);
            document.getElementById('val-cash-in2').textContent = formatVND(Cash_in);

            // Cột "Thực Hiện"
            document.getElementById('val-new1').textContent = formatCP(N_new);
            document.getElementById('val-total-n1').textContent = formatCP(N_total_1);
            document.getElementById('val-cash-out1').textContent = `-${formatVND(Cash_out)}`;
            document.getElementById('val-net-cash1').textContent = formatVND(Net_cash_1);
            document.getElementById('val-benefit').textContent = formatVND(Total_Benefit);
            
            // Cột "Từ Bỏ"
            document.getElementById('val-total-n2').textContent = formatCP(N_total_2);
            document.getElementById('val-net-cash2').textContent = formatVND(Net_cash_2);
            document.getElementById('val-loss').textContent = `-${formatVND(Total_Benefit)}`; // Lỗ bằng đúng phần lợi ích
            
            <!-- THÊM MỚI: Cập nhật nội dung cho Phần 4 -->
            const benefitFormatted = `<strong class='text-green-700'>${formatVND(Total_Benefit)}</strong>`;
            const lossFormatted = `<strong class='text-red-700'>-${formatVND(Total_Benefit)}</strong>`;
            const paFormatted = `<strong>${formatVND(Pa)}</strong>`;
            const pPrimeFormatted = `<strong>${formatVND(P_prime)}</strong>`;
            const nNewFormatted = `<strong>${formatCP(N_new)}</strong>`;

            document.getElementById('dynamic-reco-1').innerHTML = 
                `Việc phải nộp thêm tiền để mua ${nNewFormatted} có thể khiến bạn băn khoăn. 
                Tuy nhiên, đây là một <strong>cơ hội</strong>: bạn đang dùng tiền mặt để đổi lấy tài sản (cổ phiếu) với giá ${paFormatted}, 
                thấp hơn nhiều so với giá trị hợp lý của nó (là ${pPrimeFormatted}).<br>
                Khoản lợi ích tức thời ${benefitFormatted} chính là 'phần thưởng' cho hành động này. 
                Đây là hành động <strong class='text-green-700'>bảo toàn giá trị tài sản</strong>.`;

            document.getElementById('dynamic-reco-2').innerHTML = 
                `Nếu bạn từ bỏ quyền (không nộp tiền), tài sản của bạn vẫn bị pha loãng (vì giá P' đã giảm), 
                nhưng bạn lại <strong class='text-red-700'>đánh mất</strong> khoản lợi ích ${benefitFormatted} ở trên. 
                Điều này dẫn đến một khoản <strong class='text-red-700'>thiệt hại thực sự</strong> 
                do giá trị tài sản ròng của bạn bị giảm sút.`;

            // Hiển thị khối kết quả
            document.getElementById('results').style.display = 'block';
            
            // Cuộn xuống xem kết quả (trên di động)
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        });
    </script>

</body>
</html>



